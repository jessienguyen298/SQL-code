/*
Skills used: Joins, CTE's, Temp Tables, Aggregate Functions, Creating Views, Converting Data Types, procedures
*/


-- The difference in days between the most recent and oldest order date in the Orders file
SELECT DATEDIFF(D,Min(orderDate),MAX(orderDate)) as Days
FROM orders
;


--time between order date and ship date for each customer ordered by the largest difference
SELECT orderNumber, DATEDIFF(D, orderDate, shippedDate) as Days
FROM orders
ORDER BY Days DESC;


-- the value of orders shipped in August 2004
SELECT o.orderNumber, (od.quantityOrdered*od.priceEach) as orderValue, o.orderDate
FROM orders o
JOIN orderdetails od ON o.orderNumber = od.orderNumber
WHERE o.orderDate like '2004-08%'
ORDER BY o.orderDate


--the total value ordered, total amount paid, and their difference for each customer for orders placed in 2004 and payments received in 2004 
SELECT sum(od.quantityOrdered*od.priceEach) as TotalOrderValue, 
	sum(p.amount) as TotalPaid,
	(sum(od.quantityOrdered*od.priceEach)-sum(p.amount)) as difference
FROM orderdetails od 
JOIN orders o ON o.orderNumber = od.orderNumber
JOIN payments p ON p.customerNumber = o.customerNumber
WHERE o.orderDate like '2004%' AND p.paymentDate like '2004%'

--the employees who report to those employees who report to Diane Murphy
SELECT e1.employeeNumber, CONCAT(e1.firstName, ' ', e1.lastName) as fullName
FROM employees e1
JOIN employees e2
ON e1.reportsTo = e2.employeeNumber
WHERE e2.employeeNumber = 
              (SELECT employeeNumber 
              FROM employees 
              WHERE CONCAT(firstName, ' ', lastName) ='Diane Murphy');
            
	    
--the percentage value of each product in inventory
GO 
CREATE VIEW inventory as
SELECT productline, sum(quantityInStock) as stocks 
FROM products
GROUP BY productLine;

SELECT productline, 100*stocks/(SELECT SUM(stocks) FROM inventory) as percentageInStock
FROM inventory
ORDER BY percentageInStock DESC;


--convert miles per gallon to liters per 100 kilometers
/*
Convert gallon/miles to litter/100km
1 gallon = 4.546092 litter
1 miles = 1.609344 km
*/

GO
CREATE PROCEDURE convertunit @gallonPerMiles decimal(10,2)
AS
BEGIN
	DECLARE @litterper100km decimal(10,2)
	SET @litterper100km = @gallonPerMiles * (4.546092/100*1.609344);
	SELECT @litterper100km;
END




 

